version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: 'Block #1'
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - 'checkout && docker run -v ${PWD}:/opt/robotframework/tests:Z -e ROBOT_OPTIONS=''--name SuiteName'' -e ROBOT_TESTS_DIR=/opt/robotframework/tests/TestCases ppodgorsek/robot-framework:latest'
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu2004
global_job_config:
  epilogue:
    always:
      commands:
         - '[[ -f report.xml ]] && test-results publish report.xml'
- name: Run tests
  task:
    prologue:
      commands:
        - checkout
        # Creates `test-runner` image
        - bin/setup.sh
    jobs:
    - name: go test
      commands:
        # `run-specs` creates `junit.xml` file in container's /app directory
        - docker run -v $(pwd):/app test-runner run-specs

    epilogue:
      always:
        commands:
          - test-results publish junit.xml
after_pipeline:
  task:
    jobs:
      - name: Publish Results
        commands:
          - test-results gen-pipeline-report
